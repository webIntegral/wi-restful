<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/assets/img/favicon.png">
    
    <title>wi.auth</title>
    
	<!-- styles -->
	    <!-- Bootstrap -->
	    <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css">
	    
	    <!-- fontawesome -->
	    <link rel="stylesheet" href="/components/components-font-awesome/css/font-awesome.min.css">
    <!-- /styles -->
    
    <!-- app styles -->
    	<!-- Estilos Template Dashboard -->
		<link rel="stylesheet" href="/src/layout/dashboard.css">   
    <!-- /app styles -->
    
	<!-- scripts -->
		<!-- jquery -->
		<script src="/components/jquery/dist/jquery.min.js"></script>
		<!-- Lib Angular -->
		<script src="/components/angular/angular.min.js"></script>
		<!-- Lib ngResource -->
		<script src="/components/angular-resource/angular-resource.min.js"></script>
		<!-- Lib Satellizer -->
		<script src="/components/satellizer/satellizer.min.js"></script>
	<!-- /scripts -->
	
	<!-- app -->
		<!-- contact resource module -->
		<script src="/src/resource/contact/contact.mod.js"></script>
		<!-- contact resource resource -->
		<script src="/src/resource/contact/contact.res.js"></script>
		<!-- auth module -->
		<script src="/src/oauth/oauth.mod.js"></script>
	<!-- app -->
	
	<!-- Test Script -->
		<script>
			/*
			 * Test Script.
			 */
			angular
				.module('test.module', [
	                // Inject modules to test
	                'wi.oauth',
				 	'wi.resource.contact'
	            ]);
	            
	        angular
	        	.module('test.module')
	        	.controller('TestCtr', TestCtr);
	        
	        // Inject GridBarSrv to modify grid bar configuration
	        TestCtr.$inject = ['$scope', '$q', 'ContactResource', '$auth'];
	        
	        function TestCtr ($scope, $q, ContactResource, $auth) {
	        	/* jshint validthis: true */
	        	var vm = this;
	        	
	        	vm.contacts = [];
	        	vm.user = {
	     		    grant_type: 'password',
	     		    username: 'test',
	     		    password: 'test',
	     		    client_id: 'restful-wi'
	        	};
	        	vm.areyouin = false;
	        	vm.login = login;
	        	vm.logout = logout;
	        	vm.isAuthenticated = isAuthenticated;
	        	vm.fetchAll = fetchAll;
	        	
	        	activate();
	        	
	        	function activate() {
	        		vm.isAuthenticated()
	        		if (vm.areyouin) {
	        			vm.fetchAll();
	        		}
	        		vm.fetchAll();
	        		
	        	} // activate
	        	
	        	// Login action
	        	function login() {
	        		$auth.authenticate( 'restful-wi', vm.user )
	                	.then( function( response ) {
	                		
	                		vm.isAuthenticated();
	                		vm.fetchAll();
	                		
                  		// Redirect to app root, in
	                  	// window.location.href = '/';
	                })
	                .catch( function( response ) {
	                		
	                		vm.isAuthenticated();
	                	
	                	// catch errors:
	                	// 401 Invalid grant/Unauthorized
	                });
	        	}
	        	
	        	// Logout
	        	// @todo: Logout action should include a request to kill this session in the server
	        	function logout() {
	        		$auth.logout();
	        		vm.isAuthenticated();
	        		vm.contacts = [];
	        	}
	        	
	        	// Check if authenticated
	        	function isAuthenticated() {
	        		vm.areyouin = $auth.isAuthenticated();
        		};
	        	
	        	// Get all data
	        	function fetchAll() {
	        		// Query the resource
	        		ContactResource.query(
        				{
	        				page: 1,
	        				page_size:33,
	        				search: null,
	        				sorts: null
	        			}
	        		// On success
	        		).$promise.then(function(data) {
	        			// Load result on appropiated var
	        			vm.contacts = data._embedded.contact;
        			// On error
	        		}, function(error) {
	        			// Alert
	        			alert('Query method error on ContactResource.');
	        		});
	        	}; // fetch all
	        	
	        }
		</script>
	<!-- /Test Script -->
	
	<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
	<script>
		/*!
		 * IE10 viewport hack for Surface/desktop Windows 8 bug
		 * Copyright 2014-2015 Twitter, Inc.
		 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
		 */

		// See the Getting Started docs for more information:
		// http://getbootstrap.com/getting-started/#support-ie10-width

		(function () {
		  'use strict';

		  if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
		    var msViewportStyle = document.createElement('style')
		    msViewportStyle.appendChild(
		      document.createTextNode(
		        '@-ms-viewport{width:auto!important}'
		      )
		    )
		    document.querySelector('head').appendChild(msViewportStyle)
		  }

		})();
	</script>
	<!--/ IE10 viewport hack for Surface/desktop Windows 8 bug -->
	
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body ng-app="test.module">

    <div class="container-fluid">
      	<div class="row" ng-controller="TestCtr as vm">
      	
      		<div class="col-xs-6">
      		
				<form>
					<label for="username">Username</label><br>
					<input class="form-control" name="username" ng-model="vm.user.username"><br>
					<label for="password">Password</label><br>
					<input class="form-control" name="password" ng-model="vm.user.password"><br>
					<button type="button" ng-click="vm.login()">Login</button>
					<button type="button" ng-click="vm.logout()">Logout</button>
				</form>
				<h3>Status</h3>
				<p ng-if="!vm.areyouin">No autenticado</p>
				<p ng-if="vm.areyouin">Autenticado</p>
      		
      		</div>
      		      	
      		<div class="col-xs-6">
      			<h2>List contacts</h2>
      			<ul>
      				<li ng-repeat="contact in vm.contacts">ID: {{contact.id}}. NAME: {{contact.name}}</li>
      			</ul>
      		</div>     
      		   
      </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</body>
</html>